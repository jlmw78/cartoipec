# -*- coding: utf-8 -*-
"""
/***************************************************************************
 imp_ipec
                                 A QGIS plugin
 descarga cartografia desde ipec
 Generated by Plugin Builder: http://g-sherman.github.io/Qgis-Plugin-Builder/
                              -------------------
        begin                : 2021-06-17
        git sha              : $Format:%H$
        copyright            : (C) 2021 by jlmw78
        email                : j@j.j
 ***************************************************************************/

/***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
"""
from qgis.PyQt.QtCore import QSettings, QTranslator, QCoreApplication
from qgis.PyQt.QtGui import QIcon
from qgis.PyQt.QtWidgets import QAction

# Initialize Qt resources from file resources.py
from .resources import *
# Import the code for the dialog
from .cartoipec_dialog import imp_ipecDialog

import os.path
from qgis.core import *
from qgis.utils import *
from osgeo import gdal, ogr


class imp_ipec:
    """QGIS Plugin Implementation."""

    def __init__(self, iface):
        """Constructor.

        :param iface: An interface instance that will be passed to this class
            which provides the hook by which you can manipulate the QGIS
            application at run time.
        :type iface: QgsInterface
        """
        # Save reference to the QGIS interface
        self.iface = iface
        # initialize plugin directory
        self.plugin_dir = os.path.dirname(__file__)
        # initialize locale
        locale = QSettings().value('locale/userLocale')[0:2]
        locale_path = os.path.join(
            self.plugin_dir,
            'i18n',
            'imp_ipec_{}.qm'.format(locale))

        if os.path.exists(locale_path):
            self.translator = QTranslator()
            self.translator.load(locale_path)
            QCoreApplication.installTranslator(self.translator)

        # Declare instance attributes
        self.actions = []
        self.menu = self.tr(u'&importar_carto_ipec')
 
        # Check if plugin was started the first time in current QGIS session
        # Must be set in initGui() to survive plugin reloads
        self.first_start = None

    # noinspection PyMethodMayBeStatic
    def tr(self, message):
        """Get the translation for a string using Qt translation API.

        We implement this ourselves since we do not inherit QObject.

        :param message: String for translation.
        :type message: str, QString

        :returns: Translated version of message.
        :rtype: QString
        """
        # noinspection PyTypeChecker,PyArgumentList,PyCallByClass
        return QCoreApplication.translate('imp_ipec', message)


    def add_action(
        self,
        icon_path,
        text,
        callback,
        enabled_flag=True,
        add_to_menu=True,
        add_to_toolbar=True,
        status_tip=None,
        whats_this=None,
        parent=None):
        """Add a toolbar icon to the toolbar.

        :param icon_path: Path to the icon for this action. Can be a resource
            path (e.g. ':/plugins/foo/bar.png') or a normal file system path.
        :type icon_path: str

        :param text: Text that should be shown in menu items for this action.
        :type text: str

        :param callback: Function to be called when the action is triggered.
        :type callback: function

        :param enabled_flag: A flag indicating if the action should be enabled
            by default. Defaults to True.
        :type enabled_flag: bool

        :param add_to_menu: Flag indicating whether the action should also
            be added to the menu. Defaults to True.
        :type add_to_menu: bool

        :param add_to_toolbar: Flag indicating whether the action should also
            be added to the toolbar. Defaults to True.
        :type add_to_toolbar: bool

        :param status_tip: Optional text to show in a popup when mouse pointer
            hovers over the action.
        :type status_tip: str

        :param parent: Parent widget for the new action. Defaults None.
        :type parent: QWidget

        :param whats_this: Optional text to show in the status bar when the
            mouse pointer hovers over the action.

        :returns: The action that was created. Note that the action is also
            added to self.actions list.
        :rtype: QAction
        """

        icon = QIcon(icon_path)
        action = QAction(icon, text, parent)
        action.triggered.connect(callback)
        action.setEnabled(enabled_flag)

        if status_tip is not None:
            action.setStatusTip(status_tip)

        if whats_this is not None:
            action.setWhatsThis(whats_this)

        if add_to_toolbar:
            # Adds plugin icon to Plugins toolbar
            self.iface.addToolBarIcon(action)

        if add_to_menu:
            self.iface.addPluginToWebMenu(
                self.menu,
                action)

        self.actions.append(action)

        return action

    def initGui(self):
        """Create the menu entries and toolbar icons inside the QGIS GUI."""

        icon_path = ':/plugins/cartoipec/icon.png'
        self.add_action(
            icon_path,
            text=self.tr(u'web_carto_ipec'),
            callback=self.run,
            parent=self.iface.mainWindow())

        # will be set False in run()
        self.first_start = True


    def unload(self):
        """Removes the plugin menu item and icon from QGIS GUI."""
        for action in self.actions:
            self.iface.removePluginWebMenu(
                self.tr(u'&importar_carto_ipec'),
                action)
            self.iface.removeToolBarIcon(action)


    def run(self):
        """Run method that performs all the real work"""

        # Create the dialog with elements (after translation) and keep reference
        # Only create GUI ONCE in callback, so that it will only load when the plugin is started
        if self.first_start == True:
            self.first_start = False
            self.dlg = imp_ipecDialog()

        # show the dialog
        self.dlg.show()
        
        # diccionaro con nombre de localidad y nombre del archivo zip correspondiente
        dic = {"AARON CASTELLANOS":"aaroncastellanos-a3-v","ACEBAL":"acebal-a1-v","AGUARA GRANDE":"aguaragrande-a3-h","ALBARELLOS":"albarellos-a3-v","ALCORTA":"Alcorta-a2-h","ALDAO":"Aldao-a3-h","ALEJANDRA":"Alejandra-a3-v","ALVAREZ":"alvarez-a1-v","ALVEAR":"alvear-a3-h","AMBROSETTI":"Ambrosetti-a2h","AMENABAR":"amenabar-a2-h","ANGEL GALLARDO":"angelgallardo-a3-v","ANGELICA":"angelica-a3-h","ANGELONI":"angeloni-a3-h","ARBILLA":"arbilla-a3-v","AREQUITO":"arequito-a2-h","ARMINDA":"arminda-a3-h","ARMSTRONG":"armstrong-A3-h","AROCENA":"arocena-a3-v","ARROYO AGUIAR":"arroyoaguiar-a3-v","ARROYO CEIBAL":"ACEIBAL-A3-H","ARROYO LEYES":"arroyoleyes-a1-h","ARROYO SECO":"aseco-A1H","ARRUFO":"arrufo-a3-v","ARTEAGA":"arteaga_A3-h","ATALIVA":"ataliva-a3-h","AURELIA":"aurelia-a3-h","AVELLANEDA":"avellaneda-a1-h","BALNEARIO LA VERDE":"balneariolaverde-a3-h","BALNEARIO MONJE":"balnearioMonje-a3-v","BARRANCAS":"barrancas-a2-v","BARRIO ARROYO DEL MEDIO":"barrioarroyodelmedio-a3-h","BARRIO CAIMA":"BarrioCaima-A2V","BARRIO CICARELLI":"barriocicarelli-a3-v","BARRIO EL PACAA-BARRIO COMIPINI":"barrioelpacaycomipini-a3-v","BARRIO MITRE":"BarrioMitre-a3-v","BARRIOS ACAPULCO Y VERACRUZ":"boacapulcoyveracruz-a3-h","BAUER Y SIGEL":"bauerysigel-a3-h","BELLA ITALIA":"bellaitalia-a3-h","BERABEVU":"Berabevu-A3-h","BERNA":"BERNA-A3-H","BERNARDO DE IRIGOYEN":"bernadodeirigoyen-a3-v","BIGAND":"Bigand-A3-h","BOMBAL":"bombal-a3-h","BOUQUET":"bouquet-A3-h","BUSTINZA":"bustinza-a3-v","CABAL":"cabal-a3-h","CACIQUE ARIACAIQUIN":"caciqueariacaiquin-a3-h","CAFFERATA":"caferata-a3-h","CALCHAQUI":"calchaqui-a2-v","CAMPO ANDINO":"campoandino-a3-v","CANDIOTI":"candioti-a3-v","CAÑADA DE GOMEZ":"canadadegomez-A1-H","CAÑADA DEL UCLE":"canadadelucle-a3-h","CAÑADA OMBU":"canadaombu-a3-v","CAÑADA RICA":"canadarica-a3-h","CAÑADA ROSQUIN":"canadarosquin-a2-h","CAPITAN BERMUDEZ":"capitanbermudez-a1-v","CAPIVARA":"capivara-A4-v","CARCARAÑA":"carcarana-a1-h","CARLOS PELLEGRINI":"Carlospellegrini-a2-h","CARMEN":"CARMEN-A3-H","CARMEN DEL SAUCE":"carmendelsauce-a3-h","CARRERAS":"CARRERAS-A3H","CARRIZALES":"carrizales-a3-h","CASALEGNO":"casalegno-a3-v","CASAS":"casas-a3-h","CASILDA":"casilda-a0-h","CASTELAR":"Castelar-a3-h","CASTELLANOS":"castellanos-a3-h","CAVOUR":"Cavour-a3-h","CAYASTA":"Cayasta-a2-v","CAYASTACITO":"cayastacito-a3-v","CENTENO":"centeno-A3V","CEPEDA":"cepeda-a3-h","CERES":"ceres-a1-h","CHABAS":"chabas-a3-v","CHAÑAR LADEADO":"ChanarLadeado-a3-v","CHAPUY":"chapuy-a3-h","CHOVET":"chovet-a3-h","CHRISTOPHERSEN":"christophersen-a3-v","CLASSON":"classon-a3-h","COLMENA":"colmena-a3-h","COLONIA ALDAO":"coloniaaldao-a2-h","COLONIA ANA":"coloniaana-a3-h","COLONIA BELGRANO":"coloniabelgrano-a3-v","COLONIA BICHA":"coloniabicha-a3-v","COLONIA BOSSI":"coloniabossi-a3-h","COLONIA CELLO":"coloniacello-a3-h","COLONIA DOLORES":"coloniadolores-a3-h","COLONIA DURAN":"Coloniaduran-a3-v","COLONIA MARGARITA":"coloniamargarita-a3-h","COLONIA MEDICI":"coloniamedici-a3-v","COLONIA RAQUEL":"coloniaraquel-a3-v","COLONIA ROSA":"coloniarosa-a3-h","CONSTANZA":"constanza-a3-v","CORONDA":"coronda-a1-v","CORONEL ARNOLD":"cnelarnold-a3-h","CORONEL BOGADO":"coronelbogado-a3-v","CORONEL FRAGA":"coronelfraga-a3-h","CORONEL RODOLFO S. DOMINGUEZ":"coroneldominguez-a3-h","CORREA":"correa-a2-v","CRISPI":"Crispi-a3-h","CUATRO ESQUINAS":"cuatroesquinas-a3-v","CULULU":"Cululu-a3-h","CURUPAITY":"curupaity-a3-h","DESVIO ARIJON":"desvioarijon-a2v","DIAZ":"Diaz-A3V","DIEGO DE ALVEAR":"diegodealvear-a3-h","EGUSQUIZA":"egusquiza-a3-v","EL ARAZA":"elaraza-a3-h","EL CARAMELO":"elcarameloyvilladelplata-a2-v","EL RABON":"ELRABON-A3-H","EL SOMBRERITO":"elsombrerito-a3-h","EL TREBOL":"eltrebol-a1-v","ELISA":"Elisa-a3-v","ELORTONDO":"elortondo-a3-h","EMILIA":"emilia-a3-v","EMPALME SAN CARLOS":"empalmesancarlos-a3-h","EMPALME VILLA CONSTITUCION":"empalmevillaconstitucion-a2-v","ESMERALDA":"esmeralda-a3-h","ESPERANZA":"esperanza-a0-h","ESTACION CLUCELLAS":"estacionclucellas-a3-h","Estación Constituyentes (V. LAURA)":"constituyentes-a3-v","ESTACION SAGUIER":"estacionsaguier-a3-h","ESTEBAN RAMS":"estebanrams-a3-h","ESTHER":"esther-a3-h","EUSEBIA Y CAROLINA":"eusebiaycarolina-a3-h","EUSTOLIA":"eustolia-a3-h","FELICIA":"Felicia-a3-h","FIGHIERA":"fighiera-a1-h","FIRMAT":"firmat-a1-v","FLORENCIA":"FLORENCIA-A2-H","FORTIN OLMOS":"FortinOlmos-A3H","FRANCK":"Franck-a2-v","FRAY LUIS BELTRAN":"frayluisbeltran-a2-h","FRONTERA":"frontera-a2-v","FUENTES":"fuentes-a2-h","FUNES":"funes-a0-h","GABOTO":"gaboto-a2-V","GALVEZ":"galvez-a1-h","GARABATO":"Garabato-A3-V","GARIBALDI":"garibaldi-a3-h","GENERAL GELLY":"generalgelly-a3-h","GENERAL LAGOS":"generallagos-a3-h","GESSLER":"gessler-a3-v","GOBERNADOR CRESPO":"gobernadorcrespo-a2-v","GODEKEN":"Godeken-a3-h","GODOY":"godoy-a3-h","GOLONDRINA":"Golondrina-a3-v","GRANADERO BAIGORRIA":"granaderobaigorria-a1-h","GREGORIA PEREZ DE DENIS":"gregoriaperezdedenis-a3-h","GRUTLY":"grutly-a3-h","GUADALUPE NORTE":"guadalupenorte-a3-v","HELVECIA":"helvecia-a2-h","HERSILIA":"hersilia-a2-h","HIPATIA":"hipatia-a3-v","HUANQUEROS":"huanqueros-a3-h","HUGHES":"hugues-a2-h","HUMBERTO PRIMO":"humbertoprimo-a2-h","HUMBOLDT":"Humboldt-a2-v","IBARLUCEA":"Ibarlucea-a1-h","INGENIERO CHANOURDIE":"IngChanourdie-a3-h","INTIYACO":"intiyaco-A3H","IRIGOYEN":"irigoyen-a3-h","JACINTO L. ARAUZ":"jacintoarauz-a3-h","JOSEFINA":"josefina-a3-v","JUAN B. MOLINA":"jbmolina-a3-h","JUNCAL":"juncal-a3-h","KILOMETRO 101":"km101-a3-v","KILOMETRO 115":"km115-a3-v","LA BRAVA":"Labrava-a3-v","LA CABRAL":"lacabral-a3-h","LA CHISPA":"lachispa-a3-h","LA CRIOLLA":"lacriolla-a3-h","LA GALLARETA":"Lagallareta-a3-h","LA ISLETA":"laisleta-a3-v","LA PELADA":"lapelada-a3-h","LA PENCA Y CARAGUATA":"lapencaycaraguata-a3-h","LA RUBIA":"larubia-a3-h","LA SARITA":"lasarita-a3-h","LA VANGUARDIA":"lavanguardia-a3-v","LABORDEBOY":"labordeboy-a3-h","LAGUNA PAIVA":"lagunapaiva-a1-v","LANDETA":"Landeta-a3-h","LANTERI":"LANTERI-A3-H","LARGUIA":"larguia-a3-v","LARRECHEA":"larrechea-a3-h","LAS AVISPAS":"lasavispas-a3-v","LAS BANDURRIAS":"lasbandurrias-a3-h","LAS GARZAS":"lasgarzas-a3-v","LAS PALMERAS":"laspalmeras-a3-v","LAS PAREJAS":"lasparejas-a2-v","LAS PETACAS":"Laspetacas-a3-v","LAS ROSAS":"lasrosas-a1-v","LAS TOSCAS":"lastoscas-a2-v","LAS TUNAS":"lastunas-a3-h","LAZZARINO":"lazzarino-a3-h","LEHMANN":"lehmann-a3-h","LLAMBI CAMPBELL":"llambicampbell-a2-h","LOGROÑO":"logrono-a3-h","LOMA ALTA":"lomaalta-a3-h","LOPEZ":"lopez-a3-h","LOS AMORES":"losamores-a3-v","LOS CARDOS":"Loscardos-a3-h","LOS LAURELES":"loslaureles-a3-v","LOS MOLINOS":"losmolinos-a3-h","LOS MUCHACHOS-LA ALBORADA":"osmuchachos-laalborada-a3-h","LOS NOGALES":"losnogales-a3-h","LOS QUIRQUINCHOS":"LosQuirquinchos-a3-h","LOS ZAPALLOS":"loszapallos-a2-h","LUCIO V. LOPEZ":"luciovlopez-a3-h","LUIS PALACIOS":"Luispalacios-a2-v","MACIEL":"maciel-a3-v","MAGGIOLO":"maggiolo-a3-h","MALABRIGO":"malabrigo-a3-h","MARCELINO ESCALADA":"marcelinoescalada-a3-h","MARGARITA":"margarita-a3-v","MARIA JUANA":"mariajuana-a2-h","MARIA LUISA":"MariaLuisa-a3-h","MARIA SUSANA":"mariasusana-a2-v","MARIA TERESA":"mariateresa-a2-h","MATILDE":"matilde-a3-v","MAXIMO PAZ":"MaximoPaz-a3-v","MELINCUE":"melincue-a1-h","MIGUEL TORRES":"migueltorres-a3-h","MOISES VILLE":"moisesville-a2-h","MONIGOTES":"monigotes-a3-v","MONJE":"monje-a3-v","MONTE FLORES":"monteflores-a3-h","MONTE VERA":"montevera-a1-v","MONTEFIORE":"montefiore-a3-v","MONTES DE OCA":"montesdeoca-a3-h","MURPHY":"murphy-a3-h","NARE":"nare-a3-v","NELSON":"nelson-a2-v","NUEVA LEHMANN":"nuevalehmann-a3-h","NUEVO TORINO":"nuevotorino-a3-h","ÑANDUCITA":"nanducita-a3-h","OLIVEROS":"oliveros-a2-v","PALACIOS":"palacios-a3-v","PARAJE  LA COSTA":"Pjelacosta-a2-v","PARAJE 29":"paraje29-a3-v","PARAJE CHACO CHICO":"pjechacochico-a2-h","PARAJE SAN MANUEL":"parajesanmanuel-a3-v","PAVON":"pavon-a3-h","PAVON ARRIBA":"PavonArriba-a3-h","PEDRO GOMEZ CELLO":"pedrogomezcello-a3-v","PEREZ":"perez-a1-h","PEYRANO":"Peyrano-a3-v","PIAMONTE":"piamonte-a2-h","PILAR":"Pilar-A2-h","PIÑERO":"pinero-a3-h","PLAZA CLUCELLAS":"plazaclucellas-a2-h","PLAZA MATILDE":"plazamatilde-a3-h","PLAZA SAGUIER":"plazasaguier-a3-h","POZO BORRADO":"pozoborrado-a3-h","POZO DE LOS INDIOS":"pozodelosindios-a3-v","PRESIDENTE ROCA":"presidenteroca-a2-v","PROGRESO":"progreso-a2-h","PROVIDENCIA":"providencia-a3-h","PUEBLO ANDINO":"puebloandino-a2-h","PUEBLO ESTHER":"PuebloEstherA1-H","PUEBLO MARINI":"pueblomarini-a3-h","PUEBLO MUÑOZ":"pueblomunoz-a3-h","PUEBLO SANTA LUCIA":"pueblosantalucia-a3-v","PUEBLO URANGA":"uranga-a3-v","PUERTO ARAGON":"puertoaragon-a3-h","PUERTO ARROYO SECO":"puertoarroyoseco-a1-h","PUERTO GENERAL SAN MARTIN":"Puertogralsanmartin-a1-h","PUERTO RECONQUISTA":"puertoreconquista-a3-v","PUJATO":"pujato-a3-h","RAFAELA":"rafaela-a0-h","RAMAYON":"ramayon-a3-h","RAMONA":"ramona-a3-h","RECONQUISTA":"reconquista-a0-v","RECREO":"recreo-a1-v","RICARDONE":"ricardone-a2-h","RINCON POTRERO":"rinconpotrero-a1-h","ROLDAN":"roldan-a0-v","ROMANG":"Romang-a2-h","ROSARIO":"rosario-a0-v","RUEDA":"rueda-a3-h","RUFINO":"rufino-a0-h","SA PEREYRA":"sapereyra-a3-h","SALADERO MARIANO CABAL":"saladeromarianocabal-a3-h","SALTO GRANDE":"saltogrande-a2-v","SAN AGUSTIN":"sanagustin-a3-h","SAN ANTONIO":"sanantonio-a3-h","SAN ANTONIO DE OBLIGADO":"sanantoniodeobligado-a2-v","SAN BERNARDO":"sanbernardo-a3-h","SAN CARLOS CENTRO":"sancarloscentro-a1-v","SAN CARLOS NORTE":"sancarlosnorte-a3-h","SAN CARLOS SUD":"sancarlossud-a3-v","SAN CRISTOBAL":"SanCristobal-a1-v","SAN EDUARDO":"saneduardo-a3-h","SAN EUGENIO":"saneugenio-a3-v","SAN FABIAN":"sanfabian-a3-v","SAN FRANCISCO DE SANTA FE":"sanfranciscodesantafe-a3-h","SAN GENARO":"sangenaro-a1-h","SAN GREGORIO":"sangregorio-a2-h","SAN GUILLERMO":"sanguillermo-a2-h","SAN JAVIER":"sanjavier-a1-v","SAN JERONIMO DEL SAUCE":"sanjeronimodelsauce-a2-h","SAN JERONIMO NORTE":"sanjeronimonorte-a2-h","SAN JERONIMO SUR":"sanjeronimosud-a3-v","SAN JORGE":"sanjorge-a1-h","SAN JOSE DE LA ESQUINA":"sanjosedelaesquina-A2-H","SAN JOSE DEL RINCON":"SanJosedelRincon-A3-h","SAN JUSTO":"sanjusto-a1-h","SAN LORENZO":"sanlorenzo-a0-v","SAN MARIANO":"SanMariano-A3-h","SAN MARTIN DE LAS ESCOBAS":"sanmartindelasescobas-a2-h","SAN MARTIN NORTE":"sanmartinnorte-a3-h","SAN VICENTE":"sanvicente-a2-h","SANCTI SPIRITU":"sanctispiritu-a2-h","SANFORD":"sanford-a3-h","SANTA CLARA DE BUENA VISTA":"santaclaradebuenavista-a2-h","SANTA CLARA DE SAGUIER":"santaclaradesaguier-a2-h","SANTA FE":"santafe-a0-v","SANTA ISABEL":"santaisabel-a2-h","SANTA MARGARITA":"santamargarita-a3-h","SANTA ROSA DE CALCHINES":"santarosadecalchines-a2-h","SANTA TERESA":"santateresa-a3-h","SANTO DOMINGO":"santodomingo-a3-h","SANTO TOME":"Santotome-a0-v","SANTURCE":"santurce-a3-h","SARGENTO CABRAL":"sgtcabral-a3-h","SARMIENTO":"sarmiento-a3-h","SASTRE":"sastre-a2-h","SAUCE VIEJO":"sauceviejo-a0-v","SERODINO":"serodino-a2-h","SILVA":"silva-a3-v","SOLDINI":"soldini-a3-v","SOLEDAD":"soledad-a3-h","STEPHENSON":"stephenson-a3-h","SUARDI":"suardi-a2-h","SUNCHALES":"sunchales-A1h","SUSANA":"susana-a3-h","TACUARENDI":"tacuarendi-a2-h","TACURAL":"tacural-a3-h","TARTAGAL":"tartagal-a3-v","TEODELINA":"teodelina-a2-h","THEOBALD":"theobald-a3-h","TIMBUES (JESUS MARIA)":"timbues-a1-v","TOBA":"toba-a3-v","TORTUGAS":"tortugas-a3-h","TOSTADO":"tostado-a1-h","TOTORAS":"totoras-a2-h","TRAILL":"Traill-a3-v","VENADO TUERTO":"venadotuerto-a0-h","VERA":"vera-a1-v","VERA Y PINTADO":"veraypintado-A3-h","VIDELA":"videla-a3-h","VILA":"vila-a3-h","VILLA AMELIA":"villaamelia-a3-h","VILLA ANA":"villaana-a2-v","VILLA CAÑAS":"villacanas-a1-h","VILLA CONSTITUCION":"villaconstitucion-a0-h","VILLA DEL PLATA":"elcarameloyvilladelplata-a2-v","VILLA ELOISA":"villaeloisa-a3-h","VILLA ELVIRA":"villaelvira-a3-h","VILLA GOBERNADOR GALVEZ":"villagobernadorgalvez-a0-h","VILLA GUILLERMINA":"villaguillermina-a2-h","VILLA JOSEFINA":"villajosefina-a3-v","VILLA LA RIBERA (OLIVEROS)":"villalaribera-a2-h","VILLA LA RIBERA (PUEBLO ANDINO)":"villalaribera-a2-h","VILLA MINETTI":"villaminetti-a3-h","VILLA MUGUETA":"villamugueta-a3-h","VILLA OCAMPO":"villaocampo-a1-h","VILLA SAN JOSE":"villasanjose-a3-h","VILLA SARALEGUI":"villasaralegui-a3-v","VILLA TRINIDAD":"villatrinidad-a2-h","VILLADA":"villada-a3-h","VIRGINIA":"virginia-a3-v","WHEELWRIGHT":"wheelwright-a2-h","WILDERMUTH":"wildermuth-a3-h","ZAVALLA":"zavalla-a3-h","ZENON PEREYRA":"zenonpereyra-a2-v"}
        
        # lista las localidades en el comboBox
        self.dlg.comboBox.addItems(dic)
        
        # Run the dialog event loop
        result = self.dlg.exec_()
           
        # See if OK was pressed
        if result:
            loca=self.dlg.comboBox.currentText()
            layer_name = dic[loca] #toma el nombre del zip del diccionario

            # creo el grupo con el nombre de la localidad seleccionada
            root = QgsProject.instance().layerTreeRoot()
            grupo = root.addGroup(loca)
            
            # accede a la url del zip con la localidad seleccionada
            zipbase = '/vsizip//vsicurl/http://ipec.esy.es/mapas/'+layer_name+'.zip'         
            shapefiles = [layer.GetName() for layer in ogr.Open(zipbase)]
            layers = []
                            
            # lee los shape files contenidos en el zip
            for shp_name in shapefiles:                        
                shp_path = f"{zipbase}/{shp_name}.shp"
                vl = QgsVectorLayer(shp_path, shp_name, 'ogr')
                # designa el sistema de proyeccion                
                vl.setCrs(QgsCoordinateReferenceSystem(22185)) 
                
                layers.append(vl)
                grupo.addLayer(vl) #agrega la capa al grupo
                             
            # carga las capas sin mostrarlos
            QgsProject.instance().addMapLayers(layers, False)
              
            
            # asigno estilos y carga las capas
            vl_names = []
            for layer in QgsProject.instance().mapLayers().values():
                vl_names.append(layer.name())
                if layer.name().startswith('E'): #si el nombre del .shp comienza con E
                    style_path = self.plugin_dir+'/style_E.qml'
                    layer.loadNamedStyle(style_path)
                    
                elif layer.name().startswith('M'): #si el nombre del .shp comienza con M
                    style_path = self.plugin_dir+'/style_M.qml'
                    layer.loadNamedStyle(style_path)
                       
                elif layer.name().startswith('R'): #si el nombre del .shp comienza con R
                    style_path = self.plugin_dir+'/style_R.qml'
                    layer.loadNamedStyle(style_path) 

                    
            pass
